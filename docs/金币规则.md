# 金币规则

## 基础金币

**公式**：`基础金币 = 向上取整(专注时长 × 5)`

| 专注时长 | 基础金币 |
|---------|---------|
| 1 分钟  | 5       |
| 5 分钟  | 25      |
| 10 分钟 | 50      |
| 15 分钟 | 75      |
| 30 分钟 | 150     |
| 60 分钟 | 300     |

## 随机奖励

**公式**：`随机奖励 = Math.floor(Math.random() * (时长/2)) + 1`

即范围为 `1 ~ floor(时长/2) + 1`

| 专注时长 | 随机奖励范围 |
|---------|-------------|
| 1 分钟  | 1           |
| 5 分钟  | 1 ~ 3       |
| 10 分钟 | 1 ~ 5       |
| 30 分钟 | 1 ~ 15      |
| 60 分钟 | 1 ~ 30      |

## 总金币

**公式**：`总金币 = 基础金币 + 随机奖励`

## 获取金币的场景

### 1. 正常完成

完成所有轮次后，根据总专注时长计算金币奖励。

### 2. 提前完成

金币 = 已完成轮次的金币 + 当前轮次已产生的金币

**公式**：
```
总时长 = completedRounds × 每轮时长 + 当前轮次已过去的时间
总金币 = 基础金币(总时长) + 随机奖励(总时长)
```

### 3. 放弃挑战

不获得任何金币。

## 代码位置

- 奖励计算：`store/modules/sessionRewards.ts`
  - `calculateRewards(duration)` - 根据时长计算金币
  - `getTotalDuration()` - 计算累计时长（已完成轮次 + 当前轮次已过去时间）
  - `calculateRewardsFromCurrentState()` - 从当前状态自动计算奖励
- 多轮会话管理：`store/modules/multiSession.ts`
  - `finishEarly()` - 提前完成
  - `completeCurrentRound()` - 完成当前轮次
- 金币存储：`store/modules/userData.ts`
  - `addCoins(amount)` - 增加金币
  - `deductCoins(amount)` - 扣除金币
